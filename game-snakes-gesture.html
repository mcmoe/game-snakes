<link rel="import" href="../polymer/polymer.html">
<script>
	/*
	*An element providing mouse and touch controls for `game-snakes` element.
	*
	*| Action | Gesture |
	*| --- | --- |
	*| play | tap |
	*| pause | tap |
	*| turn up | swipe up |
	*| turn down | swipe down |
	*| turn left | swipe left |
	*| turn right | swipe right |
	*/
	Polymer({
		is: 'game-snakes-gesture',
		properties: {
			/*
			*`game-snakes` element to be used as target.
			*@default parent
			*/
			target: {
				type: HTMLElement,
				value: function() {
					return Polymer.dom(this).parentNode;
				},
				observer: '_targetChanged'
			},
			/*
			*Enables or disables gesture controls.
			*/
			active: {
				type: Boolean,
				value: true,
				observer: '_activeChanged'
			}
		},
		_targetChanged: function(e) {
			var f = 'function';
			if (e && typeof e.play === f && typeof e.pause === f && typeof e.turn === f) {
				this._validTarget = true;
			} else {
				this._validTarget = false;
			}
			this._check();
		},
		_activeChanged: function() {
			this._check();
		},
		_check: function() {
			if (this.active && this._validTarget) {
				if (!this._added) {
					this._added = true;
					this.listen(this.target, 'tap', '_tap');
					this.listen(this.target, 'track', '_track');
					this.setScrollDirection('none', this.target);
				}
			} else {
				if (this._added) {
					this._added = false;
					this.listen(this.target, 'tap', '_tap');
					this.listen(this.target, 'track', '_track');
					this.setScrollDirection('all', this.target);
				}
			}
		},
		_tap: function(e) {
			var tar = this.target;
			if (tar.state === 'playing') {
				tar.pause();
			} else {
				tar.play()
			}
		},
		_track: function(e) {
			var det = e.detail;
			if (det.state === 'end') {
				this.done = false;
			} else {
				var x = det.dx;
				var y = det.dy;
				var $x = Math.abs(x);
				var $y = Math.abs(y);
				if (this.done) {
					return;
				}
				if ($x > $y) {
					if (x > 0) {
						this.target.turn('right');
					} else {
						this.target.turn('left');
					}
					this.done = true;
				} else if ($y > $x) {
					if (y > 0) {
						this.target.turn('down');
					} else {
						this.target.turn('up');
					}
					this.done = true;
				}
			}
		}
	});
</script>
